# 📊 투자 판단 로직 상세 가이드

본 문서는 자동매매 시스템이 어떤 기준으로 종목을 평가하고 매매를 결정하는지 상세히 설명합니다.

---

## 📋 목차

1. [투자 프로세스 개요](#투자-프로세스-개요)
2. [투자 점수 산정 (0-10점)](#투자-점수-산정-0-10점)
3. [매수 조건](#매수-조건)
4. [매도 전략](#매도-전략)
5. [리스크 관리](#리스크-관리)

---

## 🎯 투자 프로세스 개요

### 전체 흐름

```
1. DART 공시 모니터링
   ↓
2. 단일판매공급계약 발견
   ↓
3. 종목 분석 및 점수 산정 (0-10점)
   ↓
4. 매수 조건 확인 (8점 이상 + 당일 공시)
   ↓
5. 조건 충족 시 → 전액 매수 (예수금 100%)
   ↓
6. 익절가 설정 (+3%)
   ↓
7. 보유 기간별 전략 실행
   ↓
8. 매도 체결 → 완료
```

---

## 📈 투자 점수 산정 (0-10점)

### 평가 항목 및 배점

시스템은 **5가지 핵심 지표**를 분석하여 0-10점 사이의 점수를 산정합니다.

| 평가 항목 | 배점 | 평가 기준 |
|---------|------|-----------|
| 🌐 시장 지수 | 2점 | 코스피/코스닥 200일 이동평균선 돌파 여부 |
| 💰 시가총액 | 2점 | 500억~5,000억 적정 구간 여부 |
| 📊 계약 비율 | 2점 | 매출액 대비 계약금액 20% 이상 여부 |
| 📈 거래량 | 2점 | 20일 평균 대비 2배 이상 급증 여부 |
| 🕯️ 캔들 패턴 | 2점 | 당일 양봉 여부 (긍정 신호) |

### 점수 산정 상세

#### 1. 시장 지수 (Market Index) - 2점

**목적:** 전체 시장 상승 추세 확인

```python
# 코스피 또는 코스닥 지수가 200일 이동평균선 위에 있는가?
if 현재_시장지수 > 200일_이동평균:
    점수 += 2
```

**평가 기준:**
- ✅ **+2점**: 시장 지수가 200일 이동평균선 위 → 상승 추세
- ❌ **0점**: 시장 지수가 200일 이동평균선 아래 → 하락 추세

**왜 중요한가?**
- 개별 종목은 시장 전체 흐름의 영향을 크게 받습니다
- 하락장에서는 좋은 뉴스도 주가 상승이 제한적입니다

---

#### 2. 시가총액 (Market Cap) - 2점

**목적:** 적절한 유동성과 성장 잠재력 확인

```python
# 시가총액이 500억~5,000억 사이인가?
if 500억 <= 시가총액 <= 5000억:
    점수 += 2
```

**평가 기준:**
- ✅ **+2점**: 500억~5,000억 → 적정 규모
- ❌ **0점**: 500억 미만 (너무 작음) 또는 5,000억 초과 (너무 큼)

**왜 이 구간인가?**
- **500억 미만**: 유동성 부족, 변동성 과다, 정보 부족
- **500억~5,000억**: 성장 가능성 + 안정성 균형 ✅
- **5,000억 초과**: 이미 성장한 기업, 계약 뉴스 영향력 제한적

---

#### 3. 계약 비율 (Contract Ratio) - 2점

**목적:** 계약의 중요도 평가

```python
# 계약금액이 연간 매출의 20% 이상인가?
계약비율 = 계약금액 / 최근_매출액
if 계약비율 >= 0.20:  # 20%
    점수 += 2
```

**평가 기준:**
- ✅ **+2점**: 매출액 대비 20% 이상 → 매우 중요한 계약
- ❌ **0점**: 20% 미만 → 영향력 제한적

**왜 20%인가?**
- 기업 매출의 20% 이상은 사업에 실질적 영향
- 주가에 긍정적 반영 가능성 높음
- 시장의 관심도 상승

---

#### 4. 거래량 (Volume) - 2점

**목적:** 시장의 관심도 및 유동성 확인

```python
# 당일 거래량이 20일 평균의 2배 이상인가?
if 당일_거래량 >= (20일_평균_거래량 * 2):
    점수 += 2
```

**평가 기준:**
- ✅ **+2점**: 20일 평균 대비 2배 이상 → 시장 관심 급증
- ❌ **0점**: 2배 미만 → 보통 수준

**왜 중요한가?**
- 거래량 급증 = 시장 참여자들의 관심 증가
- 유동성 확보 = 원하는 가격에 매수/매도 가능
- 상승 모멘텀 시작 신호

---

#### 5. 캔들 패턴 (Candle Pattern) - 2점

**목적:** 당일 주가 흐름의 긍정성 확인

```python
# 당일 종가가 시가보다 높은가? (양봉)
if 종가 > 시가:
    점수 += 2
```

**평가 기준:**
- ✅ **+2점**: 양봉 (종가 > 시가) → 매수세 우세
- ❌ **0점**: 음봉 (종가 ≤ 시가) → 매도세 우세

**왜 중요한가?**
- 공시 발표 후 당일 양봉 = 시장의 긍정적 반응
- 단기 상승 모멘텀 확인
- 추가 상승 가능성 시사

---

### 점수 해석

| 점수 | 평가 | 투자 매력도 | 시스템 동작 |
|-----|------|------------|-----------|
| 10점 | 완벽 | ⭐⭐⭐⭐⭐ 최상 | 자동 매수 ✅ |
| 8-9점 | 우수 | ⭐⭐⭐⭐ 매우 높음 | 자동 매수 ✅ |
| 6-7점 | 양호 | ⭐⭐⭐ 보통 | 매수 안 함 ⚠️ |
| 4-5점 | 보통 | ⭐⭐ 낮음 | 매수 안 함 ⚠️ |
| 0-3점 | 부족 | ⭐ 매우 낮음 | 매수 안 함 ❌ |

---

## 💰 매수 조건

시스템이 실제로 매수를 실행하기 위해서는 **2가지 필수 조건**이 모두 충족되어야 합니다.

### 필수 조건

#### 1. 투자 점수 8점 이상 ✅

```python
if 투자_점수 >= 8:
    # 매수 검토 진행
```

- 10점 만점 중 8점 이상 (80% 이상)
- 5가지 지표 중 최소 4가지 충족
- 높은 수익 가능성 확보

#### 2. 당일 공시 ✅

```python
if 공시_접수일 == 오늘_날짜:
    # 매수 검토 진행
```

- 공시 접수일자가 당일(KST 기준)
- 신선한 정보에 신속 대응
- 시장 반응 초기 단계 진입

### 매수 실행 상세

#### 매수 금액
```
예수금 100% 전액 투자 (올인 전략)
```

**왜 전액 투자?**
- 엄격한 조건으로 선별된 고확률 종목
- 기회가 자주 오지 않음
- 단기 고수익 추구

#### 매수 방식
```
시장가 매수 (Market Order)
```

**왜 시장가?**
- 신속한 체결 보장
- 시간이 중요 (공시 직후)
- 소량 가격 차이보다 진입 타이밍 중요

#### 매수 즉시 실행
```
1. 예수금 조회
2. 현재가 조회
3. 매수 가능 수량 계산
4. 시장가 매수 주문
5. 체결 확인 (2초 대기)
6. 익절가 설정 (+3%)
```

---

## 📉 매도 전략

### 기본 전략: 익절가 +3%

매수 즉시 **매수가의 +3% 익절가**로 지정가 매도 주문을 설정합니다.

```python
익절가 = 매수가 × 1.03
```

**예시:**
- 매수가: 10,000원
- 익절가: 10,300원 (지정가 매도 설정)

**목표:**
- 빠른 수익 실현
- 단기 트레이딩 전략
- 리스크 최소화

---

### 보유 기간별 전략

#### 📅 D+0 ~ D+4 (1일차~4일차)

**전략:** 익절가 대기

```
매도 주문: 익절가 +3% 지정가
행동: 보유 유지
```

- 익절가 도달 시 → 자동 매도 체결
- 도달하지 않으면 → 계속 보유

---

#### ⚠️ D+5 ~ D+9 (5일차~9일차)

**전략:** 조건부 매도 또는 손절가 설정

##### 경우 1: 현재가가 매수가 ~ 매수가+3% 사이
```python
if 매수가 <= 현재가 < 매수가×1.03:
    → 시장가 즉시 매도
```

**사유:** 5일간 +3% 도달 못함 → 추가 상승 가능성 낮음 → 소폭 이익이라도 실현

**예시:**
- 매수가: 10,000원
- 현재가: 10,200원 (+2%)
- 행동: 시장가 매도 → 2% 수익 실현

##### 경우 2: 현재가가 매수가 미만 (손실 구간)
```python
if 현재가 < 매수가:
    손절가 = 매수가 × 0.99
    → 손절가(-1%) 지정가 매도 설정
```

**사유:** 손실 확대 방지 → -1% 손절가 설정

**예시:**
- 매수가: 10,000원
- 현재가: 9,800원 (-2%)
- 손절가: 9,900원 (-1%)
- 행동: 9,900원 지정가 매도 설정

##### 경우 3: 현재가가 매수가+3% 이상
```
기존 익절가 유지 (이미 목표 달성 구간)
```

---

#### 🚨 D+10 이상 (10일차~)

**전략:** 무조건 시장가 매도

```python
if 보유일수 >= 10:
    → 시장가 즉시 매도 (수익률 무관)
```

**사유:** 
- 장기 보유는 전략에 맞지 않음
- 자금 회전율 저하
- 새로운 기회 포착 제한

**결과:**
- 수익: 수익 실현 ✅
- 손실: 손실 확정 후 다음 기회 대기 ⏭️

---

### 매도 프로세스

```
1. 매도 주문 실행
   ↓
2. 체결 확인 (2초 대기)
   ↓
3. 거래내역 시트 업데이트
   ↓
4. 슬랙 알림 전송
   ↓
5. 다음 매수 기회 대기
```

---

## 🛡️ 리스크 관리

### 1. 포지션 제한

```
동시 보유 가능 종목: 1개만
```

**이유:**
- 집중 투자로 수익 극대화
- 관리 단순화
- 리스크 통제 용이

### 2. 투자 금액

```
예수금 100% 투자 (단, 최소 잔액 제외)
```

**이유:**
- 선별된 고확률 종목
- 소액 분산보다 집중 투자
- 빠른 자금 회전

### 3. 손절 규칙

```
최대 손실: -1% (5일 경과 시)
강제 청산: 10일 경과 시 무조건 매도
```

**이유:**
- 손실 확대 방지
- 장기 보유 방지
- 심리적 부담 최소화

### 4. 시간 제한

```
매수 시간: 평일 08:30 ~ 15:20
매도 시간: 평일 08:30 ~ 15:30
```

**이유:**
- 유동성 확보
- 급격한 가격 변동 회피
- 시장 마감 직전 리스크 회피

### 5. API 호출 제한

```
키움증권 API: 초당 최대 1회
DART API: 초당 최대 2회
```

**이유:**
- API 차단 방지
- 서비스 안정성 유지
- 정책 준수

### 6. 중복 실행 방지

```
파일 기반 Lock 시스템
```

**이유:**
- 중복 매수 방지
- 주문 충돌 방지
- 시스템 안정성

---

## 📊 투자 성과 추적

### 자동 기록 항목

모든 거래는 구글 시트 "거래내역" 시트에 자동 기록됩니다:

| 항목 | 내용 |
|-----|------|
| 종목 정보 | 종목코드, 종목명 |
| 매수 정보 | 매수일시, 매수가, 매수수량, 매수금액 |
| 매도 정보 | 매도일시, 매도가, 매도수량, 매도금액 |
| 수익 정보 | 수익금, 수익률(%) |
| 거래 사유 | 상태, 사유, 주문번호 |

### 슬랙 실시간 알림

| 이벤트 | 알림 내용 |
|--------|----------|
| 시스템 시작 | 예수금, 보유 종목, 시장 상태 |
| 매수 시작 | 종목명, 투자 점수, 매수 조건 |
| 매수 체결 | 매수가, 수량, 익절가 |
| 매도 주문 | 매도 유형, 목표가, 사유 |
| 매도 체결 | 매도가, 수익률, 수익금 |
| 오류 발생 | 오류 유형, 상세 정보, 스택 트레이스 |

---

## 🎓 투자 로직 예시

### 예시 1: 10점 만점 종목

**상황:**
- 공시: 삼성SDI, 100억원 계약 (매출액 500억원의 20%)
- 시장: 코스닥 지수 200일선 상회 (✅ +2)
- 시가총액: 1,000억원 (✅ +2)
- 계약비율: 20% (✅ +2)
- 거래량: 평균의 3배 (✅ +2)
- 캔들: 당일 양봉 (✅ +2)
- **총점: 10점**

**시스템 동작:**
1. 슬랙 알림: "⭐ 투자 매력도 10점 (최상) - 매수 시작"
2. 예수금 1,000만원 전액 매수
3. 매수가 10,000원 × 1,000주 = 10,000,000원
4. 즉시 익절가 10,300원 매도 주문 설정
5. 슬랙 알림: "매수 체결 완료 - 1,000주 @ 10,000원"

**결과 (3일 후):**
- 익절가 10,300원 도달 → 자동 매도
- 수익: 300,000원 (수익률 +3%)
- 슬랙 알림: "매도 체결 완료 - 수익률 +3.00%"

---

### 예시 2: 5일 경과 후 소폭 이익

**상황:**
- 매수가: 10,000원 × 1,000주
- 5일 경과, 현재가: 10,150원 (+1.5%)
- 익절가 10,300원 미도달

**시스템 동작:**
1. 5일 경과 확인
2. 현재가 10,150원 < 익절가 10,300원
3. 매수가(10,000원) ~ 익절가(10,300원) 사이 확인
4. 시장가 즉시 매도 실행
5. 매도가: 10,150원 (추정)
6. 수익: 150,000원 (수익률 +1.5%)
7. 슬랙 알림: "5일 경과 - 소폭 이익 실현 +1.50%"

---

### 예시 3: 5일 경과 후 손실 구간

**상황:**
- 매수가: 10,000원 × 1,000주
- 5일 경과, 현재가: 9,700원 (-3%)
- 익절가 10,300원 미도달

**시스템 동작:**
1. 5일 경과 확인
2. 현재가 9,700원 < 매수가 10,000원 (손실 구간)
3. 손절가 설정: 10,000원 × 0.99 = 9,900원
4. 9,900원 지정가 매도 주문
5. 슬랙 알림: "5일 경과 - 손절가 설정 (매수가 -1%)"

**결과 (당일 또는 익일):**
- 주가 반등하여 9,900원 도달
- 자동 매도 체결
- 손실: -100,000원 (손실률 -1%)
- 슬랙 알림: "매도 체결 완료 - 손실률 -1.00%"

---

### 예시 4: 10일 경과 강제 청산

**상황:**
- 매수가: 10,000원 × 1,000주
- 10일 경과, 현재가: 9,500원 (-5%)

**시스템 동작:**
1. 10일 경과 확인
2. 수익률 무관하게 시장가 즉시 매도
3. 매도가: 9,500원 (추정)
4. 손실: -500,000원 (손실률 -5%)
5. 슬랙 알림: "10일 경과 - 강제 청산 -5.00%"

**사유:**
- 더 이상 보유해도 회복 가능성 낮음
- 자금 회전율 저하 방지
- 새로운 기회 포착을 위한 자금 확보

---

## 🔍 투자 로직 검증

### 백테스팅 결과 (참고용)

본 시스템의 로직은 다음 가정에 기반합니다:

1. **승률**: 약 60-70%
2. **평균 수익**: +2.5% ~ +3%
3. **평균 손실**: -1% ~ -2%
4. **기대 수익**: 양수

**주의:** 과거 성과가 미래를 보장하지 않습니다.

### 로직 개선 여지

현재 시스템은 다음 영역에서 개선 가능합니다:

1. **추가 지표**: RSI, MACD, 볼린저 밴드 등
2. **동적 익절가**: 변동성에 따른 목표가 조정
3. **부분 익절**: 일부 수익 실현 후 나머지 보유
4. **시장 상황 분석**: VIX 지수, 투자자별 매매 동향 등
5. **뉴스 분석**: 공시 외 호재/악재 뉴스 감지

---

## ⚠️ 면책 조항

**본 투자 로직은 교육 및 참고 목적으로 제공됩니다.**

- 투자 손실의 위험이 있습니다
- 모든 투자 결정과 결과는 사용자 책임입니다
- 과거 성과는 미래 수익을 보장하지 않습니다
- 시장 상황에 따라 전략의 효과가 달라질 수 있습니다
- 자동매매는 기술적 오류의 위험이 있습니다

**투자 전 충분한 이해와 검토가 필수입니다.**

자세한 내용은 [RISK_DISCLOSURE.md](RISK_DISCLOSURE.md)를 참조하세요.

---

## 📚 관련 문서

- [README.md](README.md) - 프로젝트 개요 및 시작 가이드
- [TRADING_GUIDE.md](TRADING_GUIDE.md) - 자동매매 시스템 사용 가이드
- [RISK_DISCLOSURE.md](RISK_DISCLOSURE.md) - 투자 위험 고지
- [document/rules.md](document/rules.md) - 개발 규칙 및 가이드

---

## 🔄 버전 정보

- **문서 버전**: 1.0.0
- **시스템 버전**: v4.0.0
- **최종 업데이트**: 2025-10-19
- **작성자**: 자동매매 시스템 팀

---

**💪 야수의 심장을 가진 투자자를 위한 시스템입니다!**

