# 📈 키움증권 OpenAPI 설정 가이드

## 🎯 개요

이 가이드는 DART 스크래핑 시스템에서 실시간 주식 데이터 분석을 위한 키움증권 OpenAPI 설정 방법을 설명합니다.

## 🔧 키움증권 OpenAPI 신청 및 설정 단계

### 1단계: 키움증권 계좌 개설

1. **키움증권 홈페이지** 접속: https://www.kiwoom.com
2. **계좌 개설** 진행 (비대면 계좌개설 가능)
3. **본인인증** 및 **서류 제출** 완료
4. **계좌 개설 완료** 후 로그인 가능

### 2단계: OpenAPI 신청

1. **키움 OpenAPI 사이트** 접속: https://openapi.kiwoom.com
2. **회원가입** 및 **로그인**
3. **"OpenAPI 신청"** 메뉴 클릭
4. **API 서비스 약관** 동의
5. **개발자 정보 입력**:
   - 개발 목적: 개인 투자 분석
   - 사용 예정 기간: 1년
   - 개발 언어: Python
6. **신청서 제출** 및 **승인 대기** (보통 1-2일)

### 3단계: API 키 발급

승인 완료 후:
1. **"내 애플리케이션"** 메뉴에서 앱 생성
2. **앱 정보 입력**:
   - 앱명: DART 스크래핑 시스템
   - 설명: 공시 정보 기반 주식 분석 시스템
3. **앱키(App Key)** 및 **앱시크릿(App Secret)** 발급
4. 안전한 곳에 보관

### 4단계: HTS 연동 (선택사항)

실시간 데이터 이용을 위해서는:
1. **영웅문 HTS** 설치
2. **OpenAPI** 모듈 설치
3. **계좌 연동** 및 **인증서 등록**

## 🔑 환경변수 설정

### 로컬 개발환경 (.env 파일)

```env
# 키움증권 OpenAPI
KIWOOM_APP_KEY=your_actual_app_key_here
KIWOOM_APP_SECRET=your_actual_app_secret_here
```

### 클라우드타입 배포환경

클라우드타입 대시보드에서 환경변수 추가:

```
KIWOOM_APP_KEY = your_actual_app_key_here
KIWOOM_APP_SECRET = your_actual_app_secret_here
```

## 📊 분석 기능

키움증권 API가 설정되면 다음 분석이 가능합니다:

### 1. 🏛️ 시장 지수 분석
- **KOSPI/KOSDAQ 현재 지수** vs **200일 이동평균** 비교
- 시장 전반적인 추세 파악

### 2. 💰 시가총액 분석
- **현재가 × 상장주식수** 자동 계산
- **500억 ~ 5,000억** 범위 내 종목 필터링

### 3. 📈 거래량 분석
- **현재 거래대금** vs **20일 평균 거래대금** 비교
- **2배 이상** 거래량 급증 감지

### 4. 🕯️ 캔들 분석
- **양봉/음봉** 상태 확인
- **시초가 대비 현재가** 비교

## 📱 슬랙 알림 예시

키움증권 API가 설정된 경우 다음과 같은 상세 분석이 슬랙으로 전송됩니다:

```
🚨 신규 단일판매공급계약 발견! (1건)

📋 삼성전자 (005930)
• 계약상대방: ABC 컴퍼니
• 계약금액: 150억원
• 계약내용: 반도체 부품 공급계약

📊 투자 분석: 🔥 매우 유망 | ✅ 시장지수 > 200일 이평선 | ✅ 시가총액 적정 (42,500억원) | ✅ 매출 대비 계약 비율 높음 (25.3%) | ✅ 거래 조건 모두 만족

• 현재가: 71,000원
• 시가총액: 42,500억원
• KOSPI 지수: 2,650.5 (MA200: 2,580.3)
• 거래량 비율: 2.3배 ✅
• 추천점수: 9/10점
• 캔들 상태: ✅ 양봉
```

## ⚠️ API 사용 제한

### 일일 호출 한도
- **개발용**: 1일 1,000회
- **실거래용**: 1일 10,000회 (별도 신청)

### 초당 호출 한도
- **최대 5회/초** (과도한 호출 시 일시 차단)

### 비용
- **개발용**: 무료
- **실거래용**: 월 정액제 (별도 문의)

### 제공 데이터
- **실시간 시세**: 20분 지연 (무료) / 실시간 (유료)
- **과거 데이터**: 최대 1년
- **기업 정보**: 재무제표, 기업개요 등

## 🔒 보안 주의사항

1. **API 키 보호**: 앱키와 앱시크릿은 절대 공개하지 마세요
2. **환경변수 사용**: 코드에 직접 하드코딩 금지
3. **IP 제한**: 키움증권에서 허용된 IP에서만 접근 가능
4. **계좌 보안**: 실거래 계좌 연동 시 각별한 주의 필요

## 🔍 문제 해결

### API 키 인증 실패

**증상**: "인증에 실패했습니다" 오류
**해결책**:
1. 앱키와 앱시크릿이 정확한지 확인
2. API 서비스 승인 상태 확인
3. 일일 호출 한도 초과 여부 확인
4. IP 주소 제한 확인

### 토큰 발급 실패

**증상**: 액세스 토큰 발급 오류
**해결책**:
1. 네트워크 연결 상태 확인
2. 키움증권 API 서버 상태 확인
3. 요청 형식이 올바른지 확인

### 데이터 조회 실패

**증상**: 주식 데이터 조회 안됨
**해결책**:
1. 종목코드 형식 확인 (6자리 숫자)
2. 시장 운영시간 확인 (9:00-15:30)
3. API 호출 한도 확인
4. 종목 상장 여부 확인

### HTS 연동 문제

**증상**: 실시간 데이터 수신 안됨
**해결책**:
1. 영웅문 HTS 실행 상태 확인
2. OpenAPI 모듈 설치 확인
3. 계좌 로그인 상태 확인
4. 방화벽 설정 확인

## 🆘 Mock 데이터 모드

키움증권 API가 설정되지 않은 경우:
- **자동으로 Mock 데이터** 사용
- **기본적인 분석** 기능 제공
- **실제 거래에는 사용 불가**

## 📞 지원

키움증권 OpenAPI 관련 문의:
- **고객센터**: 1588-8688
- **OpenAPI 문의**: https://openapi.kiwoom.com
- **개발자 포럼**: https://openapi.kiwoom.com/forum

## 📚 참고 자료

- **키움증권 OpenAPI 가이드**: https://openapi.kiwoom.com/guide/apiguide
- **TR 코드 목록**: 키움 REST API 문서.pdf 참조
- **샘플 코드**: Python 예제 코드 제공
- **FAQ**: 자주 묻는 질문 및 답변

## 🚀 키움증권 API 주요 TR 코드

### 주식 현재가 조회
- **TR코드**: `FHKST01010100`
- **기능**: 개별 종목의 현재가, 거래량 등 조회

### 시장지수 조회
- **TR코드**: `FHKUP03500100`
- **기능**: KOSPI, KOSDAQ 지수 및 이동평균 조회

### 일봉 차트 조회
- **TR코드**: `FHKST01010400`
- **기능**: 일별 OHLCV 데이터 조회

### 거래량 순위 조회
- **TR코드**: `FHPST01710000`
- **기능**: 거래량 급증 종목 조회

---

**💡 참고**: 키움증권 API는 선택사항이므로 설정하지 않아도 기본 기능(DART 스크래핑, 구글 시트 저장)은 정상 작동합니다. 단, 상세한 주식 분석 기능은 제한됩니다.
