# 📈 한국투자증권 KIS API 설정 가이드

## 🎯 개요

이 가이드는 DART 스크래핑 시스템에서 실시간 주식 데이터 분석을 위한 한국투자증권 KIS API 설정 방법을 설명합니다.

## 🔧 KIS API 신청 및 설정 단계

### 1단계: KIS Developers 가입

1. **KIS Developers 사이트** 접속: https://apiportal.koreainvestment.com
2. **회원가입** 진행
3. **본인인증** 완료
4. **약관동의** 및 **개발자 등록**

### 2단계: API 서비스 신청

1. **"API 신청"** 메뉴 클릭
2. **"국내주식"** 서비스 선택
3. **앱 정보 입력**:
   - 앱명: DART 스크래핑 시스템
   - 설명: 공시 정보 기반 주식 분석 시스템
   - 용도: 개인 투자 분석
4. **신청서 제출** 및 **승인 대기**

### 3단계: API 키 발급

승인 완료 후:
1. **"내 앱"** 메뉴에서 생성된 앱 확인
2. **앱키(App Key)** 및 **앱시크릿(App Secret)** 복사
3. 안전한 곳에 보관

## 🔑 환경변수 설정

### 로컬 개발환경 (.env 파일)

```env
# 한국투자증권 KIS API
KIS_APP_KEY=your_actual_app_key_here
KIS_APP_SECRET=your_actual_app_secret_here
```

### 클라우드타입 배포환경

클라우드타입 대시보드에서 환경변수 추가:

```
KIS_APP_KEY = your_actual_app_key_here
KIS_APP_SECRET = your_actual_app_secret_here
```

## 📊 분석 기능

KIS API가 설정되면 다음 분석이 가능합니다:

### 1. 🏛️ 시장 지수 분석
- **KOSPI/KOSDAQ 현재 지수** vs **200일 이동평균** 비교
- 시장 전반적인 추세 파악

### 2. 💰 시가총액 분석
- **현재가 × 상장주식수** 자동 계산
- **500억 ~ 5,000억** 범위 내 종목 필터링

### 3. 📈 거래량 분석
- **현재 거래대금** vs **20일 평균 거래대금** 비교
- **2배 이상** 거래량 급증 감지

### 4. 🕯️ 캔들 분석
- **양봉/음봉** 상태 확인
- **시초가 대비 현재가** 비교

## 📱 슬랙 알림 예시

KIS API가 설정된 경우 다음과 같은 상세 분석이 슬랙으로 전송됩니다:

```
🚨 신규 단일판매공급계약 발견! (1건)

📋 삼성전자 (005930)
• 계약상대방: ABC 컴퍼니
• 계약금액: 150억원
• 계약내용: 반도체 부품 공급계약

📊 투자 분석: 🔥 매우 유망 | ✅ 시장지수 > 200일 이평선 | ✅ 시가총액 적정 (42,500억원) | ✅ 매출 대비 계약 비율 높음 (25.3%) | ✅ 거래 조건 모두 만족

• 현재가: 71,000원
• 시가총액: 42,500억원
• KOSPI 지수: 2,650.5 (MA200: 2,580.3)
• 거래량 비율: 2.3배 ✅
• 추천점수: 9/10점
• 캔들 상태: ✅ 양봉
```

## ⚠️ API 사용 제한

### 일일 호출 한도
- **개발용**: 1일 1,000회
- **상용**: 1일 10,000회 (별도 신청)

### 초당 호출 한도
- **최대 20회/초**

### 비용
- **개발용**: 무료
- **상용**: 월 정액제 (별도 문의)

## 🔒 보안 주의사항

1. **API 키 보호**: 앱키와 앱시크릿은 절대 공개하지 마세요
2. **환경변수 사용**: 코드에 직접 하드코딩 금지
3. **접근 제한**: 필요한 IP에서만 접근하도록 설정
4. **정기 갱신**: 보안을 위해 정기적으로 키 갱신 권장

## 🔍 문제 해결

### API 키 인증 실패

**증상**: "인증에 실패했습니다" 오류
**해결책**:
1. 앱키와 앱시크릿이 정확한지 확인
2. API 서비스 승인 상태 확인
3. 일일 호출 한도 초과 여부 확인

### 토큰 발급 실패

**증상**: 액세스 토큰 발급 오류
**해결책**:
1. 네트워크 연결 상태 확인
2. KIS API 서버 상태 확인
3. 요청 형식이 올바른지 확인

### 데이터 조회 실패

**증상**: 주식 데이터 조회 안됨
**해결책**:
1. 종목코드 형식 확인 (6자리 숫자)
2. 시장 운영시간 확인
3. API 호출 한도 확인

## 🆘 Mock 데이터 모드

KIS API가 설정되지 않은 경우:
- **자동으로 Mock 데이터** 사용
- **기본적인 분석** 기능 제공
- **실제 거래에는 사용 불가**

## 📞 지원

KIS API 관련 문의:
- **KIS Developers 고객센터**: 1588-0990
- **온라인 문의**: https://apiportal.koreainvestment.com
- **FAQ**: API 포털 내 자주묻는질문 참조

---

**💡 참고**: KIS API는 선택사항이므로 설정하지 않아도 기본 기능(DART 스크래핑, 구글 시트 저장)은 정상 작동합니다. 단, 상세한 주식 분석 기능은 제한됩니다.
