# 📢 슬랙 웹훅 설정 가이드

## 🎯 개요

이 가이드는 DART 스크래핑 시스템에서 신규 계약 발견 시 슬랙으로 알림을 받기 위한 웹훅 설정 방법을 설명합니다.

## 🔧 슬랙 웹훅 설정 단계

### 1단계: 슬랙 워크스페이스 접속

1. 알림을 받을 슬랙 워크스페이스에 로그인
2. 관리자 권한이 있는 계정으로 접속 필요

### 2단계: Incoming Webhook 앱 설치

1. **슬랙 앱 디렉토리** 접속: https://slack.com/apps
2. **"Incoming Webhooks"** 검색
3. **"Add to Slack"** 버튼 클릭
4. 워크스페이스 선택 후 **"Allow"** 클릭

### 3단계: 웹훅 설정

1. **채널 선택**: 알림을 받을 채널 선택 (예: #일반, #알림)
2. **"Add Incoming Webhooks integration"** 클릭
3. **웹훅 URL 복사**: `https://hooks.slack.com/services/...` 형태의 URL

### 4단계: 클라우드타입 환경변수 설정

클라우드타입 대시보드에서 다음 환경변수 추가:

```
변수명: SLACK_WEBHOOK
값: https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX
```

## 📱 알림 메시지 예시

### 신규 계약 발견 시

```
🚨 신규 단일판매공급계약 발견! (2건)

📋 삼성전자 (005930)
• 계약상대방: ABC 컴퍼니
• 계약금액: 150억원
• 계약내용: 반도체 부품 공급계약
• 계약기간: 2025-01-01 ~ 2025-12-31
• 매출액 대비: 5.2%

📋 LG화학 (051910)
• 계약상대방: XYZ 코퍼레이션
• 계약금액: 80억 5,000만원
• 계약내용: 배터리 소재 공급계약
• 계약기간: 2025-02-01 ~ 2026-01-31
• 매출액 대비: 3.1%
```

### 시스템 완료 알림

```
ℹ️ DART 스크래핑 시스템
DART 스크래핑 완료: 총 3건의 신규 계약을 발견했습니다.
```

### 오류 발생 시

```
❌ DART 스크래핑 시스템
회사 '삼성전자' 처리 중 오류 발생: API 호출 한도 초과
```

## ⚙️ 알림 설정 옵션

### 알림 활성화/비활성화

- **활성화**: `SLACK_WEBHOOK` 환경변수에 유효한 웹훅 URL 설정
- **비활성화**: `SLACK_WEBHOOK` 환경변수를 설정하지 않거나 빈 값으로 설정

### 알림 채널 변경

웹훅 설정에서 채널을 변경하거나, 코드에서 다음 부분을 수정:

```python
# src/utils/slack_notifier.py 파일의 _create_contract_message 메서드에서
"channel": "#원하는채널명"  # 기본값: "#일반"
```

## 🔍 문제 해결

### 웹훅 URL 오류

**증상**: 슬랙 알림이 전송되지 않음
**해결책**: 
1. 웹훅 URL이 정확한지 확인
2. 슬랙 앱이 워크스페이스에 설치되어 있는지 확인
3. 로그에서 오류 메시지 확인

### 채널 권한 오류

**증상**: "channel_not_found" 오류
**해결책**:
1. 봇이 해당 채널에 초대되었는지 확인
2. 채널명이 정확한지 확인 (# 포함)

### 메시지 형식 오류

**증상**: 메시지가 깨져서 표시됨
**해결책**:
1. JSON 형식이 올바른지 확인
2. 특수문자 이스케이프 처리 확인

## 🎨 메시지 커스터마이징

### 봇 이름 변경

```python
"username": "원하는 봇 이름"  # 기본값: "DART 스크래핑 봇"
```

### 아이콘 변경

```python
"icon_emoji": ":chart:"  # 기본값: ":chart_with_upwards_trend:"
```

### 색상 변경

```python
"color": "#ff0000"  # 빨간색으로 변경
```

## 🔒 보안 주의사항

1. **웹훅 URL 보호**: 웹훅 URL은 민감한 정보이므로 공개하지 마세요
2. **환경변수 사용**: 코드에 직접 하드코딩하지 말고 환경변수 사용
3. **권한 최소화**: 필요한 채널에만 메시지 전송 권한 부여

## 📊 모니터링

### 알림 전송 로그

시스템 로그에서 다음과 같은 메시지로 알림 상태 확인:

```
2025-09-14 20:45:30 | INFO | 슬랙 알림 전송 성공: 2개 신규 계약
2025-09-14 20:45:31 | ERROR | 슬랙 웹훅 전송 실패: HTTP 400
```

### 알림 통계

- 총 전송된 알림 수
- 성공/실패 비율
- 평균 응답 시간

## 🆘 지원

슬랙 웹훅 설정 중 문제가 발생하면:

1. 슬랙 공식 문서 참조: https://api.slack.com/messaging/webhooks
2. 웹훅 URL 유효성 테스트
3. 시스템 로그 확인

---

**💡 팁**: 테스트용으로 별도 채널(예: #테스트)을 만들어 웹훅을 먼저 테스트해보는 것을 권장합니다.
